<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ä¼‘å‡ç™»è¨˜ç³»çµ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <style>
    body { font-family: "Noto Sans TC", Arial, sans-serif; background: #f4f6f8; margin:0; padding:20px;}
    h1,h2{text-align:center;}
    .container{max-width:900px;margin:auto;}
    .card{background:white;border-radius:12px;padding:20px;margin-bottom:30px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
    label{display:block;margin-top:15px;font-weight:bold;}
    input,select,textarea,button{width:100%;margin-top:6px;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;}
    textarea{resize:vertical;}
    button{background:#4f46e5;color:white;border:none;margin-top:20px;cursor:pointer;}
    button:hover{background:#4338ca;}
    iframe{width:100%;height:500px;border:none;border-radius:8px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“… ä¼‘å‡ç™»è¨˜ç³»çµ±</h1>

    <!-- ä¼‘å‡ç”³è«‹ -->
    <div class="card">
      <h2>ğŸ“ ä¼‘å‡ç”³è«‹</h2>
      <form 
        action="https://docs.google.com/forms/u/0/d/1x4_Qp6DXdyMEwoq8cFZCSFM9XrEtUgbl3UoLKRqamb8/formResponse" 
        method="POST" 
        target="hidden_iframe" 
        onsubmit="alert('å·²é€å‡ºä¼‘å‡ç”³è«‹ï¼'); setTimeout(() => window.initCalendar(), 500);"
      >
        <label>å§“å</label>
        <input type="text" name="entry.1976827451" required>
        
        <label>ä¼‘å‡é–‹å§‹æ—¥</label>
        <input type="date" name="entry.1083401554" required>
        
        <label>ä¼‘å‡çµæŸæ—¥</label>
        <input type="date" name="entry.678899297" required>
        
        <label>å‡åˆ¥</label>
        <select name="entry.1551710315" required>
          <option value="">è«‹é¸æ“‡</option>
          <option value="ç‰¹ä¼‘">ç‰¹ä¼‘</option>
          <option value="äº‹å‡">äº‹å‡</option>
          <option value="ç—…å‡">ç—…å‡</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
        
        <label>å‚™è¨»</label>
        <textarea name="entry.2071643667" rows="3"></textarea>
        
        <button type="submit">ğŸ“¤ æäº¤ä¼‘å‡</button>
      </form>
    </div>

    <!-- å·²ç™»è¨˜æ¸…å–® -->
    <div class="card">
      <h2>ğŸ“‹ ç›®å‰å·²ç™»è¨˜ä¼‘å‡æ¸…å–®</h2>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRq1zsQ8krn9aflClnTqSxI_Nsw866lq6pVdehvJAocW4hGISGPRR7BTOSBNConlCZ-UiaTnnUKMEbU/pubhtml"></iframe>
    </div>

    <!-- æœˆæ›† -->
    <div class="card">
      <h2>ğŸ—“ï¸ ä¼‘å‡æœˆæ›†</h2>
      <div id="calendar"></div>
    </div>
  </div>

  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <script>
  const calendarEl = document.getElementById('calendar');

  async function loadEvents() {
    const res = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vRq1zsQ8krn9aflClnTqSxI_Nsw866lq6pVdehvJAocW4hGISGPRR7BTOSBNConlCZ-UiaTnnUKMEbU/pub?output=csv');
    const csv = await res.text();

    const rows = csv.split('\n').map(r =>
      r.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)?.map(v => v.replace(/^"|"$/g,'').trim())
    );

    const header = rows[0];
    const dataRows = rows.slice(1);
    const events = [];

    const idxName = header.indexOf('å§“å');
    const idxStart = header.indexOf('ä¼‘å‡é–‹å§‹æ—¥'); // ä¿®æ­£æ¬„ä½åç¨±
    const idxEnd = header.indexOf('ä¼‘å‡çµæŸæ—¥');
    const idxType = header.indexOf('å‡åˆ¥');
    const idxNote = header.indexOf('å‚™è¨»');

    dataRows.forEach(r => {
      if(!r || !r[idxStart]) return;

      const name = r[idxName];
      const type = r[idxType] || '';
      const note = r[idxNote] || '';
      const startDate = new Date(r[idxStart]);
      const endDate = new Date(r[idxEnd] || r[idxStart]);

      for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
        let color = '#6366f1';
        if(type.includes('ç‰¹ä¼‘')) color = '#22c55e';
        else if(type.includes('äº‹å‡')) color = '#f59e0b';
        else if(type.includes('ç—…å‡')) color = '#ef4444';

        const eventDate = new Date(d);
        events.push({
          title: `${name}ï¼ˆ${type}ï¼‰`,
          start: eventDate.toISOString().split('T')[0],
          allDay:true,
          color,
          extendedProps: {note}
        });
      }
    });

    return events;
  }

  async function initCalendar() {
    const events = await loadEvents();
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView:'dayGridMonth',
      locale:'zh-tw',
      height:'auto',
      headerToolbar: {left:'prev,next today',center:'title',right:'dayGridMonth,listMonth'},
      events,
      eventClick(info){
        if(info.event.extendedProps.note){
          alert('å‚™è¨»ï¼š'+info.event.extendedProps.note);
        }
      }
    });
    calendar.render();
  }

  // è¨­ç‚ºå…¨åŸŸï¼Œæ–¹ä¾¿è¡¨å–®é€å‡ºå¾Œå‘¼å«åˆ·æ–°
  window.initCalendar = initCalendar;

  initCalendar();
  </script>
</body>
</html>
